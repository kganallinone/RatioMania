<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Your Website</title>
</head>
<style>
    @font-face {
        font-family: 'NicoMoji';
        src: url('./src/font/NicoMoji-Regular.ttf') format('truetype'); /* Replace with the actual path */
        font-weight: normal;
        font-style: normal;
    }

    .font-nico-moji {
        font-family: 'NicoMoji', sans-serif;
    }

</style>
<body class="bg-gray-800 overflow-auto w-screen h-screen">
    <audio autoplay="" loop src="./src/sound/bg.mp3"></audio>
<!-- Header -->
<!-- Header -->
<header class="bg-gray-900 text-white py-4 px-4 md:px-16 flex items-center justify-between h-1/8">

    <!-- Left side with logo -->
    <div>
        <img src="./src/icon/LOGO.png" class="h-12 md:h-16" alt="Logo">
    </div>

    <!-- Right side with Google Home Icon and link -->
    <div class="flex items-center">
        <a href="#" id="home-link" class="text-white mx-2 md:mx-4">
            <i class="material-icons text-2xl">home</i>
        </a>
    </div>
</header>




    <section class="py-4 px-5 md:px-16 overflow-x-auto whitespace-no-wrap flex gap-28 h-7/8 mt-20">
    
        
        <div class="flex-none w-64 h-full bg-gray-900 ml-10 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage1_img" alt="Stage Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 1</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Terminating by Tenths</span>
                <a href="#" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="goTo('stage1')">GO</a>
            </div>
        </div>
        
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage2_img" alt="Stage 2 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 2</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Terminating by Hundredths</span>
                <a href="#" id="stage2Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage2')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage3_img" alt="Stage 3 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 3</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Terminating by Thousandths</span>
                <a href="#" id="stage3Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage3')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage4_img" alt="Stage 4 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 4</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Terminating by Ten Thousandths</span>
                <a href="#" id="stage4Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage4')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage5_img" alt="Stage 5 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 5</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Mixed Terminating</span>
                <a href="#" id="stage5Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage5')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage6_img" alt="Stage 6 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 6</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Non-Terminating by Tenths</span>
                <a href="#" id="stage6Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage6')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage7_img" alt="Stage 7 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 7</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Non-Terminating by Hundredths</span>
                <a href="#" id="stage7Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage7')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage8_img" alt="Stage 8 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 8</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Non-Terminating by Thousandths</span>
                <a href="#" id="stage8Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage8')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage9_img" alt="Stage 9 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 9</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Non-Terminating by Ten Thousandths</span>
                <a href="#" id="stage9Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage9')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3">
            <img src="./src/bg/STAGEBG.png" id="stage10_img" alt="Stage 10 Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Stage 10</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Mixed Non-Terminating</span>
                <a href="#" id="stage10Button" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage10')">GO</a>
            </div>
        </div>
        
        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3 mr-10">
            <img src="./src/bg/STAGEBG.png" id="stage_final_img" alt="Final Stage Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Final Stage</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">QUIZ</span>
                <a href="#" id="stage_finalButton" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage_final')">GO</a>
            </div>
        </div>

        <div class="flex-none w-64 h-full bg-gray-900 rounded-md overflow-hidden shadow-lg p-3 mr-10">
            <img src="./src/bg/STAGEBG.png" id="problem-solving-stage_img" alt="Final Stage Image" class="w-full h-32 object-cover rounded-md border-2 border-white">
            <div class="p-4">
                <span class="block text-gray-200 text-center text-lg font-semibold mb-2">Additional Stage</span>
                <span class="block text-yellow-500 text-center font-bold mb-4">Problem Solving</span>
                <a href="#" id="problem-solving-stageButton" class="block bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'problem-solving-stage')">GO</a>
            </div>
        </div>
        
   
        <!-- Modal HTML -->
 <!-- Modal HTML -->
<div id="buyModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-8 rounded-lg w-96 m-5">
        <span class="material-icons cursor-pointer absolute top-4 right-4 text-gray-200 font-bold p-1" onclick="closeModal()">close</span>
        <p id="priceMessage" class="text-lg font-semibold mb-4 text-blue-800">Your price message goes here.</p>
        <!-- Updated button with an id and onclick attribute -->
        <button id="buyBttn" class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none focus:shadow-outline-blue" onclick="buyStage()">Buy Stage</button>
    </div>
</div>

        
        
        

        
    </section>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <script src="./feature/auth/config.js"></script>
    <script>
        function getUsernameFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('username');
        }
        
        homeURL();

        function homeURL() {
            // Get the username
            const username = getUsernameFromURL();
            const homeLink = document.getElementById('home-link');

            // Append the username as a query parameter to the link
            homeLink.href = `dashboard.html?username=${username}`;
        }


        function goTo(stage) {
            // Get the username
            const username = getUsernameFromURL();

            // Check if the username is available
            if (username) {
                // Construct the URL with both stage and username parameters
                const url = `./stage/game.html?stage=${stage}&username=${username}`;
     
                // Navigate to the constructed URL
                window.location.href = url;
            } else {
         
            }
        }

       

        function closeModal() {
            const modal = document.getElementById('buyModal');
            modal.classList.add('hidden');
        }

        function displayModal(username, stage) {
    const buyBttn = document.getElementById('buyBttn');
    const modal = document.getElementById('buyModal');
    const priceMessage = document.getElementById('priceMessage');

    if (username && stage) {
        const userRef = firebase.database().ref(`/player_info/${username}`);

        // Retrieve the brilliance_pts value before updating the stage status
        userRef.once('value')
            .then(snapshot => {
                const brilliancePts = snapshot.child('brilliance_pts').val();

                let stageRequirement;

                // Set brilliance point requirement based on the stage
                switch (stage) {
                    case 'stage1':
                        name = "Stage 1";
                        stageRequirement = 0; // Set your requirement for Stage 1
                        break;
                    case 'stage2':
                    name = "Stage 2";
                        stageRequirement = 250;
                        break;
                    case 'stage3':
                    name = "Stage 3";
                        stageRequirement = 750;
                        break;
                    case 'stage4':
                    name = "Stage 4";
                        stageRequirement = 1500;
                        break;
                    case 'stage5':
                    name = "Stage 5";
                        stageRequirement = 2500;
                        break;
                    case 'stage6':
                    name = "Stage 6";
                        stageRequirement = 3500;
                        break;
                    case 'stage7':
                    name = "Stage 7";
                        stageRequirement = 5000;
                        break;
                    case 'stage8':
                    name = "Stage 8";
                        stageRequirement = 7500;
                        break;
                    case 'stage9':
                    name = "Stage 9";
                        stageRequirement = 11000;
                        break;
                    case 'stage10':
                    name = "Stage 10";
                        stageRequirement = 15000;
                        break;
                    case 'stage_final':
                    name = "Final Stage";
                        stageRequirement = 20000;
                        break;

                    case 'problem-solving-stage':
                    name = "Problem Solving Stage";
                        stageRequirement = 30000;
                        break;

                    default:
                        stageRequirement = 0; // Set a default value or handle the default case
                        break;
                }

                if (brilliancePts < stageRequirement) {
                    // If brilliance_pts is less than the stage requirement, set button text to "LOCKED"
                    priceMessage.textContent = `Brilliance Points: ${brilliancePts}. ${name} is LOCKED. Required: ${stageRequirement}`;
                    modal.classList.remove('hidden');
                    buyBttn.classList.add('hidden');

                } else {
                    const stageRef = userRef.child(stage);

                    // Retrieve the current value before updating
                    stageRef.once('value')
                        .then(snapshot => {
                            const currentValue = snapshot.val();

                            // Check if the current value is 'OFF' before updating
                            if (currentValue === 'OFF') {
                                let price;
                                let name;

                                // Assign the price based on the stage
                                switch (stage) {
                                    case 'stage1':
                                        name = 'Stage 1';
                                        price = 0; // Set your price for Stage 1
                                        break;
                                    case 'stage2':
                                        name = 'Stage 2';
                                        price = 500;
                                        break;
                                    case 'stage3':
                                        name = 'Stage 3';
                                        price = 1000;
                                        break;
                                    case 'stage4':
                                        name = 'Stage 4';
                                        price = 2500;
                                        break;
                                    case 'stage5':
                                        name = 'Stage 5';
                                        price = 4000;
                                        break;
                                    case 'stage6':
                                        name = 'Stage 6';
                                        price = 5500;
                                        break;
                                    case 'stage7':
                                        name = 'Stage 7';
                                        price = 8000;
                                        break;
                                    case 'stage8':
                                        name = 'Stage 8';
                                        price = 10000;
                                        break;
                                    case 'stage9':
                                        name = 'Stage 9';
                                        price = 15500;
                                        break;
                                    case 'stage10':
                                        name = 'Stage 10';
                                        price = 20000;
                                        break;
                                    case 'stage_final':
                                        name = 'Final Stage';
                                        price = 30000;
                                        break;

                                    case 'problem-solving-stage':
                                        name = 'Problem Solving Stage';
                                        price = 40000;
                                        break;


                                    default:
                                        // Handle the default case if stage is not recognized
                                        break;
                                }

                                priceMessage.textContent = `Price for ${name}: $${price}`;
                                modal.classList.remove('hidden');

                                // Store username and stage in the modal for use in the buyStage function
                                modal.setAttribute('data-username', username);
                                modal.setAttribute('data-stage', stage);

                            } else {
                                // Stage is already open, proceed to the selected stage
                                closeModal();
                                goTo(stage);
                            }
                        })
                        .catch(error => {
                            console.error("Error retrieving current stage status:", error);
                        });
                }
            })
            .catch(error => {
                console.error("Error retrieving brilliance_pts:", error);
            });
    }
}


        function buyStage() {
            // Get the stored username and stage from the modal
            const username = document.getElementById('buyModal').getAttribute('data-username');
            const stage = document.getElementById('buyModal').getAttribute('data-stage');

            // Implement the logic for buying the stage here

            // Update the user data in Firebase Realtime Database
            if (username && stage) {
                const userRef = firebase.database().ref(`/player_info/${username}`);
                const stageRef = userRef.child(stage);
                
                // Retrieve the current user data
                userRef.once('value')
                    .then(snapshot => {
                        const userData = snapshot.val();
                        
                        // Check if the user has enough coins
                        const price = (stage === 'stage2') ? 500 : (stage === 'stage3') ? 1000 : (stage === 'stage4') ? 2500 : (stage === 'stage5') ? 4000 : (stage === 'stage6') ? 5500 : (stage === 'stage7') ? 8000 : (stage === 'stage8') ? 10000 : (stage === 'stage9') ? 15500 : (stage === 'stage10') ? 20000 : (stage === 'stage_final') ? 30000 :  (stage === 'problem-solving-stage') ? 40000 : 0; // Add more stages as needed
                        
                        if (userData.coin >= price) {
                            // Deduct the price from the user's coin
                            const newCoin = userData.coin - price;

                            // Update the user's coin and change the stage status to OPEN
                            userRef.update({ coin: newCoin });
                            stageRef.set('OPEN')
                                .then(() => {
                                    // Redirect to the selected stage
                                    closeModal();
                                    goTo(stage);
                                })
                                .catch(error => {
                                    console.error("Error updating stage status:", error);
                                });
                        } else {
                            alert("Not enough coins to buy this stage.");
                        }
                    })
                    .catch(error => {
                        console.error("Error retrieving user data:", error);
                    });
                }
            }

    </script>

    <script>
    function updateGoButton(username, stage) {
    const userRef = firebase.database().ref(`/player_info/${username}`);

    userRef.once('value')
        .then(snapshot => {
            const brilliancePts = snapshot.child('brilliance_pts').val();
            let stageRequirement;

            // Set brilliance point requirement based on the stage
            switch (stage) {
                case 'stage1':
                    stageRequirement = 0; // Set your requirement for Stage 1
                    break;
                case 'stage2':
                    stageRequirement = 250;
                    break;
                case 'stage3':
                    stageRequirement = 750;
                    break;
                case 'stage4':
                    stageRequirement = 1500;
                    break;
                case 'stage5':
                    stageRequirement = 2500;
                    break;
                case 'stage6':
                    stageRequirement = 3500;
                    break;
                case 'stage7':
                    stageRequirement = 5000;
                    break;
                case 'stage8':
                    stageRequirement = 7500;
                    break;
                case 'stage9':
                    stageRequirement = 11000;
                    break;
                case 'stage10':
                    stageRequirement = 15000;
                    break;
                case 'stage_final':
                    stageRequirement = 20000;
                    break;
                case 'problem-solving-stage':
                    stageRequirement = 30000;
                    break;
                default:
                    stageRequirement = 0; // Set a default value or handle the default case
                    break;
            }

 
            const goButton = document.getElementById(`${stage}Button`); 
            const stageImg = document.getElementById(`${stage}_img`);

            if (brilliancePts < stageRequirement) {
                // If brilliance_pts is less than the stage requirement, set button text to "LOCKED"
                goButton.textContent = "LOCKED";
                stageImg.src = "./src/bg/locked.png";
            } else {
                // If brilliance_pts is equal to or greater than the stage requirement, set button text to "GO"
                goButton.textContent = "GO";
                stageImg.src = "./src/bg/STAGEBG.png";
            }
        })
        .catch(error => {
            console.error("Error retrieving brilliance_pts:", error);
        });
}

        
        updateGoButton(getUsernameFromURL(), 'stage2');
        updateGoButton(getUsernameFromURL(), 'stage3');
        updateGoButton(getUsernameFromURL(), 'stage4');
        updateGoButton(getUsernameFromURL(), 'stage5');
        updateGoButton(getUsernameFromURL(), 'stage6');
        updateGoButton(getUsernameFromURL(), 'stage7');
        updateGoButton(getUsernameFromURL(), 'stage8');
        updateGoButton(getUsernameFromURL(), 'stage9');
        updateGoButton(getUsernameFromURL(), 'stage10');
        updateGoButton(getUsernameFromURL(), 'stage_final');
        updateGoButton(getUsernameFromURL(), 'problem-solving-stage');
    </script>


</body>
</html>
