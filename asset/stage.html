<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <title>Your Website</title>
</head>
<style>
    @font-face {
        font-family: 'NicoMoji';
        src: url('./src/font/NicoMoji-Regular.ttf') format('truetype'); /* Replace with the actual path */
        font-weight: normal;
        font-style: normal;
    }

    .font-nico-moji {
        font-family: 'NicoMoji', sans-serif;
    }

</style>
<body class="bg-gray-800 overflow-auto w-screen">
<!-- Header -->
<!-- Header -->
<header class="bg-gray-900 text-white py-4 px-4 md:px-16 flex items-center justify-between">

    <!-- Left side with logo -->
    <div>
        <img src="/asset/src/icon/LOGO.png" class="h-12 md:h-16" alt="Logo">
    </div>

    <!-- Right side with Google Home Icon and link -->
    <div class="flex items-center">
        <a href="#" id="home-link" class="text-white mx-2 md:mx-4">
            <i class="material-icons text-2xl">home</i>
        </a>
    </div>
</header>




    <section class="py-4 px-5 md:px-16">
    
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 1</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Terminating by Tenths </span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="goTo('stage1')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 2</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Terminating by Hundredths</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage2')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 3</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Terminating by Thousandths</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage3')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 4</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Terminating by Ten Thousandths</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage4')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 5</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Mixed Terminating</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage5')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 6</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Non-Terminating by tenths</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage6')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 7</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center"> Non-Terminating by Hundredths </span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage7')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 8</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Non-Terminating by Thousandths</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage8')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 9</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Non-Terminating by Ten Thousandths</span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage9')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Stage 10</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">Mixed Non-Terminating </span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage10')">GO</a>
        </div>
        <div class="grid grid-cols-10 bg-gray-700 p-2 rounded-md shadow-lg mb-4 ">
            <span class="col-span-2 text-white text-center">Final Stage</span>
            <span class="col-span-6 text-yellow-500 font-bold text-center">QUIZ </span>
            <a href="#" class="col-span-2 bg-gray-500 text-white px-3 py-1 rounded-md text-center" onclick="displayModal(getUsernameFromURL(), 'stage_final')">GO</a>
        </div>
   
        <!-- Modal HTML -->
        <div id="buyModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
            <div class="bg-white p-8 rounded-lg">
                <span class="material-icons cursor-pointer absolute top-4 right-4 text-gray-700" onclick="closeModal()">close</span>
                <p id="priceMessage" class="text-lg font-semibold mb-4"></p>
                <button class="bg-blue-500 text-white px-4 py-2 rounded-md" onclick="buyStage()">Buy Stage</button>
            </div>
        </div>

        
    </section>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.1/firebase-database.js"></script>
    <script src="./feature/auth/config.js"></script>
    <script>
        function getUsernameFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('username');
        }
        
        homeURL();

        function homeURL() {
            // Get the username
            const username = getUsernameFromURL();
            const homeLink = document.getElementById('home-link');

            // Append the username as a query parameter to the link
            homeLink.href = `dashboard.html?username=${username}`;
        }


        function goTo(stage) {
            // Get the username
            const username = getUsernameFromURL();

            // Check if the username is available
            if (username) {
                // Construct the URL with both stage and username parameters
                const url = `./stage/game.html?stage=${stage}&username=${username}`;
     
                // Navigate to the constructed URL
                window.location.href = url;
            } else {
         
            }
        }

       

        function closeModal() {
            const modal = document.getElementById('buyModal');
            modal.classList.add('hidden');
        }

        function displayModal(username, stage) {

            const modal = document.getElementById('buyModal');
            const priceMessage = document.getElementById('priceMessage');

            if (username && stage) {
                const userRef = firebase.database().ref(`/player_info/${username}/${stage}`);
                
                // Retrieve the current value before updating
                userRef.once('value')
                    .then(snapshot => {
                        const currentValue = snapshot.val();
                        
                        // Check if the current value is 'OFF' before updating
                        if (currentValue === 'OFF') {
                                let price;
                                if (stage === 'stage2') {
                                    name = "Stage 2"
                                    price = 500;
                                } else if (stage === 'stage3') {
                                    name = "Stage 3"
                                    price = 1000;
                                }
                                else if (stage === 'stage4') {
                                    name = "Stage 4"
                                    price = 2500;
                                }
                                else if (stage === 'stage5') {
                                    name = "Stage 5"
                                    price = 4000;
                                }
                                else if (stage === 'stage6') {
                                    name = "Stage 6"
                                    price = 5500;
                                }
                                else if (stage === 'stage7') {
                                    name = "Stage 7"
                                    price = 8000;
                                }
                                else if (stage === 'stage8') {
                                    name = "Stage 8"
                                    price = 10000;
                                }
                                else if (stage === 'stage9') {
                                    name = "Stage 9"
                                    price = 15500;
                                }
                                else if (stage === 'stage10') {
                                    name = "Stage 10"
                                    price = 20000;
                                }
                                else if (stage === 'stage_final') {
                                    name = "Final Stage"
                                    price = 30000;
                                }

                                priceMessage.textContent = `Price for ${name}: $${price}`;
                                modal.classList.remove('hidden');

                                // Store username and stage in the modal for use in the buyStage function
                                modal.setAttribute('data-username', username);
                                modal.setAttribute('data-stage', stage);
                     
                        } else {
                            // Stage is already open, proceed to the selected stage
                            closeModal();
                            goTo(stage);
                        }
                    })
                    .catch(error => {
                        console.error("Error retrieving current stage status:", error);
                    });
            }
         
        }

        function buyStage() {
            // Get the stored username and stage from the modal
            const username = document.getElementById('buyModal').getAttribute('data-username');
            const stage = document.getElementById('buyModal').getAttribute('data-stage');

            // Implement the logic for buying the stage here

            // Update the user data in Firebase Realtime Database
            if (username && stage) {
                const userRef = firebase.database().ref(`/player_info/${username}`);
                const stageRef = userRef.child(stage);
                
                // Retrieve the current user data
                userRef.once('value')
                    .then(snapshot => {
                        const userData = snapshot.val();
                        
                        // Check if the user has enough coins
                        const price = (stage === 'stage2') ? 500 : (stage === 'stage3') ? 1000 : (stage === 'stage4') ? 2500 : (stage === 'stage5') ? 4000 : (stage === 'stage6') ? 5500 : (stage === 'stage7') ? 8000 : (stage === 'stage8') ? 10000 : (stage === 'stage9') ? 15500 : (stage === 'stage10') ? 20000 : (stage === 'final_stage') ? 30000 : 0; // Add more stages as needed
                        
                        if (userData.coin >= price) {
                            // Deduct the price from the user's coin
                            const newCoin = userData.coin - price;

                            // Update the user's coin and change the stage status to OPEN
                            userRef.update({ coin: newCoin });
                            stageRef.set('OPEN')
                                .then(() => {
                                    // Redirect to the selected stage
                                    closeModal();
                                    goTo(stage);
                                })
                                .catch(error => {
                                    console.error("Error updating stage status:", error);
                                });
                        } else {
                            alert("Not enough coins to buy this stage.");
                        }
                    })
                    .catch(error => {
                        console.error("Error retrieving user data:", error);
                    });
                }
            }

    </script>


</body>
</html>
